<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>محرك البحث</title>
  <!-- <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap"
      rel="stylesheet"
    /> -->
  <style>
    :root {
      --c-header: #5F6F96;
      /* الهيدر */
      --c-bg: #4a5775;
      /* خلفية الصفحة */
      --c-divider: rgba(255, 255, 255, 0.15);
      --c-text: rgba(255, 255, 255, 0.95);
      /* نص أبيض واضح */
      --c-search-bg: #dce2f0;
      /* خلفية مربع البحث */
      --c-search-left: #b0bcd4;
      /* خلفية أيقونة البحث */
    }


    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      /*font-family: 'DIN Next LT Arabic', sans-serif;*/
      direction: rtl;
      margin: 0;

      font-family: 'Graphik Arabic', sans-serif;

      /* font-family: "Tajawal", Tahoma, Arial, sans-serif;*/
      color: var(--c-text);
      background: var(--c-bg);
      -webkit-user-select: none;
    }

    /* الهيدر */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 5;
      height: 56px;
      display: grid;
      grid-template-columns: 40px 1fr 40px;
      align-items: center;
      padding: 0 8px;
      background: #1f3a64;
      color: #fff;
    }

    .btn {
      width: 36px;
      height: 36px;
      display: grid;
      place-items: center;
      border: none;
      background: transparent;
      color: #fff;
      cursor: pointer;
      border-radius: 8px;
    }

    .title {
      text-align: center;
      font-weight: 700;
    }

    /* البحث */
    .searchWrap {
      padding: 12px 10px;
    }

    .searchBox {
      display: flex;
      align-items: center;
      width: 100%;
      max-width: 320px;
      border-radius: 4px;
      overflow: hidden;
    }

    .searchLeft {
      width: 54px;
      height: 40px;
      background: var(--c-search-left);
      display: grid;
      place-items: center;
      border: 1px solid rgba(0, 0, 0, 0.15);
      border-inline-end: none;
    }

    .searchRight {
      flex: 1;
      height: 40px;
      background: var(--c-search-bg);
      border: 1px solid rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      padding: 0 10px;
    }

    .searchRight input {
      all: unset;
      flex: 1;
      color: #1a2b32;
      direction: rtl;
    }

    .results {
      padding: 10px;
    }

    .res {
      background: transparent;
      border-bottom: 1px solid var(--c-divider);
      padding: 10px 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .res:last-child {
      border-bottom: none;
    }

    .res .icon {
      width: 18px;
      height: 18px;
      color: #fff;
    }

    .res .label {
      flex: 1;
      color: #fff;
    }

    .hidden {
      display: none !important;
    }

    mark {
      background: #ffd54a;
      color: #2b2b2b;
      padding: 0 2px;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <!-- الهيدر -->
  <div class="topbar">
    <!-- زر إغلاق يسار -->
    <button class="btn" id="btnClose" aria-label="إغلاق">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round">
        <path d="M18 6L6 18M6 6l12 12" />
      </svg>
    </button>
    <!-- العنوان وسط -->
    <div class="title">محرك البحث</div>
    <!-- أيقونة بحث يمين -->
    <button class="btn" aria-label="بحث">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round">
        <circle cx="11" cy="11" r="7"></circle>
        <path d="M21 21l-3.5-3.5"></path>
      </svg>
    </button>
  </div>

  <!-- صندوق البحث -->
  <div class="searchWrap">
    <div class="searchBox">
      <div class="searchLeft">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#333" stroke-width="2"
          stroke-linecap="round">
          <circle cx="11" cy="11" r="7"></circle>
          <path d="M21 21l-3.5-3.5"></path>
        </svg>
      </div>
      <label class="searchRight">
        <input id="q" type="search" placeholder="ادخل كلمة البحث هنا ..." />
      </label>
    </div>
  </div>

  <!-- النتائج -->
  <div id="results" class="results"></div>

  <script>
    /* عناصر القائمة */
    const items = [
      { key: "UN01_INFO_001", title: "مقدمة البرنامج", items: [] },
      { key: "UN01_INFO_002", title: "أهداف البرنامج", items: [] },
      { key: "UN01_ASS_01", title: "تقييم قبلي ", items: [] },
      { key: "UN01_INFO_01", title: "أهداف الوحدة", items: [] },
      { key: "UN01_INFO_02", title: "تعريف الذكاء العاطفي", items: [] },
      { key: "UN01_TEMP_01", title: "أهمية الذكاء العاطفي", items: [] },
      { key: "UN01_TEMP_02", title: "مكونات الذكاء العاطفي", items: [] },
      { key: "UN01_INFO_03", title: "الفرق بين الذكاء العاطفي والذكاء العقلي", items: [] },
      { key: "UN01_INFO_04", title: "العلاقة بين الذكاء العاطفي والذكاء العقلي", items: [] },
      { key: "UN01_TEMP_03", title: "مبررات تدريس الذكاء العاطفي", items: [] },
      { key: "UN01_INFO_05", title: "حالة تدريبية", items: [] },
      { key: "UN01_ACT_01", title: "نشاط تفاعلي", items: [] },
      { key: "UN01_VID08", title: "ملخص الوحدة", items: [] },
      { key: "UN01_ASS_01", title: "تقييم الوحدة", items: [] }
    ];

    /* تطبيع النصوص للبحث بالعربية */
    const norm = (s) =>
      (s || "")
        .replace(/[\u064B-\u065F]/g, "")
        .replace(/[إأآا]/g, "ا")
        .replace(/ة/g, "ه")
        .replace(/ى/g, "ي")
        .replace(/[^\p{Letter}\p{Number}\s]/gu, " ")
        .replace(/\s+/g, " ")
        .trim();

    const resBox = document.getElementById("results");
    const q = document.getElementById("q");

    function render(list, query = "") {
      if (!list.length) {
        resBox.innerHTML = "";
        return;
      }
      const nq = norm(query);
      const hi = (txt) => {
        if (!nq) return txt;
        try {
          const rx = new RegExp(
            "(" + nq.replace(/[.*+?^${}()|[\]\\]/g, "\\$&") + ")",
            "gi"
          );
          return txt.replace(rx, "<mark>$1</mark>");
        } catch (_) {
          return txt;
        }
      };

      resBox.innerHTML = list
        .map(
          (it) => `
    <div class="res" data-key="${it.key}">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M12 7l7.5 3.75L12 14.5 4.5 10.75 12 7z"/>
        <path d="M19.5 12.75L12 16.5 4.5 12.75M19.5 16.5L12 20.25 4.5 16.5"/>
      </svg>
      
      <!-- updated on 24 Oct -->

     <div class="label">${hi(it.title)}</div>
    </div>
  `
        )
        .join("");

      // عند الضغط على نتيجة
      resBox.querySelectorAll(".res").forEach((el) => {
        el.addEventListener("click", () => {
          const key = el.getAttribute("data-key");
          try {
            parent.postMessage({ type: "extMenu:navigate", key }, "*");
          } catch (e) { }
          try {
            parent.postMessage("extMenu:close", "*");
          } catch (e) { }
        });
      });
    }

    /* البحث */
    function doSearch() {
      const query = q.value || "";
      const nq = norm(query);
      if (!nq) {
        resBox.innerHTML = "";
        return;
      }

      /*<!-- updated on 24 Oct -->*/

      const matches = items.filter((it) => norm(it.title).includes(nq));

      render(matches, query);
    }
    q.addEventListener("input", doSearch);

    /* زر الإغلاق */
    document
      .getElementById("btnClose")
      .addEventListener("click", function () {
        try {
          parent.postMessage("extMenu:close", "*");
        } catch (e) { }
      });
  </script>
</body>

</html>